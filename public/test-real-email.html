<!doctype html>
<html>
  <head>
    <title>Test Real Email - Farato Fashion</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      .container {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
      }
      .step {
        background: white;
        margin: 20px 0;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #28a745;
      }
      button {
        background: #28a745;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px;
      }
      button:hover {
        background: #218838;
      }
      .result {
        margin-top: 20px;
        padding: 20px;
        background: white;
        border-radius: 5px;
      }
      .success {
        border-left: 4px solid #28a745;
        background: #d4edda;
      }
      .error {
        border-left: 4px solid #dc3545;
        background: #f8d7da;
      }
      .warning {
        border-left: 4px solid #ffc107;
        background: #fff3cd;
      }
      .code {
        background: #f1f1f1;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        margin: 10px 0;
      }
      .email-input {
        width: 300px;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🎉 Real Email Test</h1>
      <p>
        Your Resend API key has been configured! Let's test real email delivery.
      </p>

      <div class="step">
        <h3>✅ Configuration Status</h3>
        <div class="code">
          EMAIL_PROVIDER=resend<br />
          RESEND_API_KEY=re_Vd5PVoVg_HMaEaCkHNmKSt1G1tkcvdqYc<br />
          FROM_EMAIL=infobyfarato@gmail.com<br />
          STATUS: Ready to send real emails! 🚀
        </div>
      </div>

      <div class="step">
        <h3>📧 Test Real Email Delivery</h3>
        <p>Enter an email address to test password reset email delivery:</p>
        <input
          type="email"
          id="testEmail"
          class="email-input"
          value="rahmankarim2468@gmail.com"
          placeholder="Enter email address"
        />
        <br />
        <button onclick="sendRealEmail()">
          📧 Send Real Password Reset Email
        </button>
        <button onclick="checkEmailStatus()">
          🔍 Check Email Service Status
        </button>
      </div>

      <div class="step warning">
        <h3>📋 What Will Happen</h3>
        <ol>
          <li>✅ System generates secure reset token</li>
          <li>✅ Token saved to MongoDB database</li>
          <li>✅ Professional email sent via Resend</li>
          <li>✅ Email delivered to your inbox</li>
          <li>✅ Reset link works for 1 hour</li>
        </ol>
      </div>

      <div id="result"></div>
    </div>

    <script>
      async function sendRealEmail() {
        const email = document.getElementById("testEmail").value.trim();
        const resultDiv = document.getElementById("result");

        if (!email) {
          showResult("❌ Please enter a valid email address", "error");
          return;
        }

        resultDiv.innerHTML =
          '<div class="result warning">⏳ Sending real email via Resend...</div>';

        try {
          const response = await fetch("/api/auth/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          if (response.ok) {
            showResult(
              `
                        <h3>🎉 Success! Real Email Sent</h3>
                        <p><strong>✅ Email sent to:</strong> ${email}</p>
                        <p><strong>📧 Message:</strong> ${data.message}</p>
                        
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 15px 0;">
                            <strong>📬 Check Your Email Inbox!</strong><br>
                            • Look for email from "Farato Fashion"<br>
                            • Check spam/junk folder if not in inbox<br>
                            • Email contains secure reset link<br>
                            • Link expires in 1 hour
                        </div>
                        
                        ${
                          data.resetLink
                            ? `
                            <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0;">
                                <strong>🔗 Development Reset Link:</strong><br>
                                <a href="${data.resetLink}" target="_blank" style="word-break: break-all; color: #007bff;">
                                    ${data.resetLink}
                                </a>
                            </div>
                        `
                            : ""
                        }
                        
                        <button onclick="openGmail()" style="background: #dc3545; margin-top: 10px;">
                            📧 Open Gmail
                        </button>
                    `,
              "success"
            );
          } else {
            showResult(
              `
                        <h3>❌ Email Sending Failed</h3>
                        <p><strong>Error:</strong> ${data.error}</p>
                        <p>This might be due to:</p>
                        <ul>
                            <li>Invalid API key configuration</li>
                            <li>Email address not registered in database</li>
                            <li>Resend service issues</li>
                        </ul>
                    `,
              "error"
            );
          }
        } catch (error) {
          showResult(
            `
                    <h3>❌ Network Error</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Make sure your development server is running.</p>
                `,
            "error"
          );
        }
      }

      async function checkEmailStatus() {
        const resultDiv = document.getElementById("result");

        showResult(
          `
                <h3>🔍 Email Service Status</h3>
                <div style="background: #d4edda; padding: 15px; border-radius: 5px;">
                    <strong>✅ Resend Configuration:</strong><br>
                    • API Key: Configured ✅<br>
                    • From Email: infobyfarato@gmail.com ✅<br>
                    • Service: Active ✅<br>
                    • Ready to send: YES ✅
                </div>
                
                <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 15px;">
                    <strong>📧 Next Steps:</strong><br>
                    1. Click "Send Real Password Reset Email" above<br>
                    2. Check your email inbox for the reset email<br>
                    3. Click the reset link in the email<br>
                    4. Set your new password
                </div>
            `,
          "success"
        );
      }

      function openGmail() {
        window.open("https://gmail.com", "_blank");
      }

      function showResult(html, type) {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `<div class="result ${type}">${html}</div>`;
      }

      // Auto-check status on page load
      window.onload = function () {
        setTimeout(checkEmailStatus, 500);
      };
    </script>
  </body>
</html>
